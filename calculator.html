<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Basic Calculator</title>
  <style>
    :root{
      --bg:#000000; --panel:#111111; --accent:#ff4da6; --muted:#94a3b8; --glass: rgba(255,255,255,0.04);
      --btn:#1a1a1a; --btn-hover: rgba(255,255,255,0.03); --danger:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(135deg,#071029 0%, #0b1020 100%);display:flex;align-items:center;justify-content:center;padding:24px;color:#e6eef8}
    .calculator{width:360px;max-width:100%;background:linear-gradient(180deg,var(--panel),#021027);border-radius:16px;box-shadow:0 10px 30px rgba(2,6,23,0.7);padding:18px}

    .display{background:var(--glass);padding:14px;border-radius:12px;margin-bottom:12px;min-height:72px;display:flex;flex-direction:column;justify-content:center}
    .expr{font-size:18px;color:var(--muted);word-break:break-all}
    .result{font-size:28px;color:#fff;font-weight:600;text-align:right}
    .small-muted{font-size:12px;color:var(--muted);}

    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    button{background:transparent;border:0;padding:16px;border-radius:10px;font-size:18px;color:var(--accent);cursor:pointer;transition:transform .06s ease,background .08s;box-shadow:inset 0 -2px 0 rgba(0,0,0,0.25)}
    button:active{transform:translateY(2px)}
    .btn-ghost{background:transparent;color:var(--muted)}
    .btn-op{background:linear-gradient(180deg, rgba(96,165,250,0.12), rgba(96,165,250,0.06));color:var(--accent)}
    .btn-eq{grid-column:span 2;background:linear-gradient(90deg,var(--accent),#3b82f6);color:#04132a;font-weight:700}
    .btn-wide{grid-column:span 2}
    .btn-digit{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:#e6eef8}
    .btn-danger{background:linear-gradient(180deg, rgba(239,68,68,0.12), rgba(239,68,68,0.06));color:var(--danger)}

    .kbd-tip{margin-top:10px;font-size:12px;color:var(--muted)}

    /* Responsive touch-friendly scaling */
    @media (max-width:420px){.calculator{padding:12px}.display{min-height:68px}.kbd-tip{font-size:11px}}
  </style>
</head>
<body>
  <main class="calculator" role="application" aria-label="Basic calculator">
    <section class="display" aria-live="polite">
      <div class="expr" id="expression" aria-hidden="true">0</div>
      <div class="result" id="result">0</div>
    </section>

    <section class="grid" role="group" aria-label="calculator buttons">
      <button class="btn-ghost" data-action="clear" title="Clear (Esc)">C</button>
      <button class="btn-ghost" data-action="back" title="Backspace (Backspace)">⌫</button>
      <button class="btn-ghost" data-value="(" title="Left parenthesis">(</button>
      <button class="btn-ghost" data-value=")" title="Right parenthesis">)</button>

      <button class="btn-digit" data-value="7">7</button>
      <button class="btn-digit" data-value="8">8</button>
      <button class="btn-digit" data-value="9">9</button>
      <button class="btn-op" data-value="/">÷</button>

      <button class="btn-digit" data-value="4">4</button>
      <button class="btn-digit" data-value="5">5</button>
      <button class="btn-digit" data-value="6">6</button>
      <button class="btn-op" data-value="*">×</button>

      <button class="btn-digit" data-value="1">1</button>
      <button class="btn-digit" data-value="2">2</button>
      <button class="btn-digit" data-value="3">3</button>
      <button class="btn-op" data-value="-">−</button>

      <button class="btn-digit" data-value="0">0</button>
      <button class="btn-digit" data-value=".">.</button>
      <button class="btn-eq" data-action="equals">=</button>
      <button class="btn-op" data-value="+">+</button>

    </section>

    <div class="kbd-tip">Tip: Use your keyboard — numbers, + - * /, Enter = evaluate, Backspace = delete, Esc = clear.</div>
  </main>

  <script>
    (function(){
      const exprEl = document.getElementById('expression');
      const resEl = document.getElementById('result');
      let expression = '';

      // helpers
      function sanitizeVisible(s){
        return s === '' ? '0' : s;
      }

      function updateDisplay(){
        exprEl.textContent = sanitizeVisible(expression);
        // try evaluate
        const r = tryEval(expression);
        if(r === null){ resEl.textContent = 'Error'; resEl.style.opacity = 0.9; }
        else{ resEl.textContent = r; resEl.style.opacity = 1; }
      }

      function appendToExpr(token){
        // keep it simple: prevent two consecutive operators (except parentheses and dot handling)
        if(token === '+'||token === '-'||token==='*'||token==='/' ){
          if(expression === ''){ // allow leading minus
            if(token !== '-') return; // ignore leading + * /
          }
          const last = expression.slice(-1);
          if(['+','-','*','/','.'].includes(last)){
            // replace last operator with new (but allow parentheses)
            expression = expression.slice(0,-1) + token;
            updateDisplay();
            return;
          }
        }
        if(token === '.'){
          // avoid multiple dots in same number: find last operator
          const lastChunk = expression.split(/[-+*/()\s]/).pop();
          if(lastChunk.includes('.')) return; // ignore second dot
          if(lastChunk === '') expression += '0';
        }
        expression += token;
        updateDisplay();
      }

      function clearAll(){ expression = ''; updateDisplay(); }
      function backspace(){ expression = expression.slice(0,-1); updateDisplay(); }

      function tryEval(raw){
        if(raw.trim() === '') return 0;
        // allow only digits, operators, parentheses, decimal and spaces
        if(!/^[0-9+\-*/().\s]+$/.test(raw)) return null;
        try{
          // Prevent accidental huge expressions — limit length
          if(raw.length > 200) return null;
          // Evaluate using Function to avoid direct eval. Still restrict characters above.
          const safe = new Function('return (' + raw + ')');
          const val = safe();
          if(!isFinite(val)) return null;
          // trim trailing .0 for integers
          return Number.isInteger(val) ? val : roundTo(val, 10);
        }catch(e){
          return null;
        }
      }

      function roundTo(n, places){
        const p = Math.pow(10, places);
        return Math.round((n + Number.EPSILON) * p)/p;
      }

      // button handling
      document.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const v = btn.dataset.value;
          const a = btn.dataset.action;
          if(a === 'clear') clearAll();
          else if(a === 'back') backspace();
          else if(a === 'equals'){
            const r = tryEval(expression);
            if(r === null) { resEl.textContent = 'Error'; }
            else { expression = String(r); updateDisplay(); }
          }
          else if(v) {
            // map visible symbols to actual tokens
            appendToExpr(v);
          }
        });
      });

      // keyboard support
      window.addEventListener('keydown', (ev)=>{
        if(ev.key === 'Escape') { ev.preventDefault(); clearAll(); return; }
        if(ev.key === 'Backspace') { ev.preventDefault(); backspace(); return; }
        if(ev.key === 'Enter' || ev.key === '='){ ev.preventDefault(); // equals
          const r = tryEval(expression);
          if(r === null) { resEl.textContent = 'Error'; }
          else { expression = String(r); updateDisplay(); }
          return;
        }
        // allow digits
        if(/^[0-9]$/.test(ev.key)) { appendToExpr(ev.key); return; }
        if(ev.key === '+'||ev.key === '-'||ev.key === '*'||ev.key === '/') { appendToExpr(ev.key); return; }
        if(ev.key === '.' || ev.key === '(' || ev.key === ')') { appendToExpr(ev.key); return; }

        // numpad support: map * and / and + - already covered
      });

      // initialize
      clearAll();

      // expose for debugging
      window._calc = {tryEval, appendToExpr, clearAll, backspace};
    })();
  </script>
</body>
</html>
